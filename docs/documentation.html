<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Documentation de la grammaire du langage de test pour les fichiers .shtest">
  <title>Grammaire du langage de tests</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2em;
      background: #1e1e1e;
      color: #f5f5f5;
      line-height: 1.6;
    }
    h1, h2, h3 {
      color: #ffffff;
    }
    pre, code {
      background: #2a2a2a;
      padding: 4px 8px;
      border-radius: 5px;
    }
    .section {
      margin-bottom: 2em;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1em;
    }
    th, td {
      border: 1px solid #444;
      padding: 0.5em;
    }
    th {
      background-color: #333;
    }
    .example {
      margin-top: 0.5em;
      font-style: italic;
    }
    a {
      color: #6fa8dc;
    }
  </style>
</head>
<body>
  <h1>Grammaire du Langage de Tests</h1>

  <div class="section">
    <h2>Syntaxe Générale</h2>
    <p>Chaque ligne suit le format&nbsp;:</p>
    <pre><code>Action: &lt;description&gt; ; Resultat: &lt;résultat attendu&gt;</code></pre>
    <p>Les points ou point-virgules finaux du résultat sont ignorés.</p>
  </div>

  <div class="section">
    <h2>Commandes et Paramètres</h2>

    <h3>Commandes d'action</h3>
    <table>
      <tr><th>Syntaxe</th><th>Alias</th><th>Description</th></tr>
      <tr><td><code>créer</code></td><td><code>configurer</code></td><td>Initialisation de l'environnement</td></tr>
      <tr><td><code>exécuter</code></td><td><code>lancer</code>, <code>traiter</code></td><td>Lancement du traitement</td></tr>
      <tr><td><code>exécuter /chemin/script.sh</code></td><td>-</td><td>Spécifie un script à exécuter</td></tr>
      <tr><td><code>Step: NOM</code></td><td><code>Étape</code>, <code>Etape</code></td><td>Démarre une nouvelle étape</td></tr>
      <tr><td><code>exécuter le script SQL fichier.sql</code></td><td>-</td><td>Exécute un script SQL de préparation</td></tr>
    </table>
    <h4>Résultats compatibles</h4>
    <table>
      <tr><th>Syntaxe</th><th>Alias</th><th>Description</th></tr>
      <tr><td><code>retour N</code></td><td><code>Le script retourne un code N</code></td><td>Vérifie le code de retour</td></tr>
      <tr><td><code>stdout=VALEUR</code></td><td><code>La sortie standard est VALEUR</code></td><td>Compare la sortie standard</td></tr>
      <tr><td><code>stderr=VALEUR</code></td><td><code>La sortie d'erreur est VALEUR</code></td><td>Compare la sortie d'erreur</td></tr>
      <tr><td><code>stdout contient MOTIF</code></td><td><code>La sortie standard contient MOTIF</code>, <code>Le script affiche un code "MOTIF"</code></td><td>Recherche motif dans stdout</td></tr>
      <tr><td><code>stderr contient MOTIF</code></td><td><code>La sortie d'erreur contient MOTIF</code></td><td>Recherche motif dans stderr</td></tr>
      <tr><td><code>le fichier /chemin existe</code></td><td><code>Le fichier /chemin est présent</code></td><td>Vérifie l'existence d'un fichier</td></tr>
      <tr><td><code>Le fichier est présent</code></td><td>-</td><td>Validation de la présence du dernier fichier manipulé</td></tr>
      <tr><td><code>le fichier est copié</code></td><td>-</td><td>Vérifie la copie d'un fichier</td></tr>
      <tr><td><code>le dossier est copié</code></td><td>-</td><td>Vérifie la copie d'un dossier</td></tr>
      <tr><td><code>le fichier CHEMIN a les droits MODE</code></td><td>-</td><td>Vérifie les droits d'un fichier</td></tr>
      <tr><td><code>le dossier CHEMIN a les droits MODE</code></td><td>-</td><td>Vérifie les droits d'un dossier</td></tr>
      <tr><td><code>le fichier CHEMIN contient MOTIF</code></td><td>-</td><td>Recherche un motif dans le fichier</td></tr>
      <tr><td><code>le fichier CHEMIN contient exactement VALEUR</code></td><td>-</td><td>Compare le contenu du fichier</td></tr>
      <tr><td><code>fichier_identique FICHIER1 FICHIER2</code></td><td><code>Le fichier FICHIER1 est identique à FICHIER2</code></td><td>Compare deux fichiers</td></tr>
      <tr><td><code>la date du fichier CHEMIN est TIMESTAMP</code></td><td>-</td><td>Vérifie la date de modification du fichier</td></tr>
      <tr><td><code>le dossier CHEMIN existe</code></td><td>-</td><td>Vérifie l'existence d'un dossier</td></tr>
      <tr><td><code>le dossier CHEMIN contient N fichiers PATTERN</code></td><td>-</td><td>Compte les fichiers correspondants</td></tr>
      <tr><td><code>retour 0 et (stdout contient OK ou stderr contient WARNING)</code></td><td>-</td><td>Combine plusieurs validations avec <code>et</code> ou <code>ou</code></td></tr>

    </table>

    <h3>Manipulation de fichiers</h3>
    <table>
      <tr><th>Syntaxe</th><th>Alias</th><th>Description</th></tr>
      <tr><td><code>créer fichier=CHEMIN avec les droits=MODE</code></td><td><code>mettre à jour</code></td><td>Crée ou modifie un fichier</td></tr>
      <tr><td><code>toucher le fichier CHEMIN -t TIMESTAMP</code></td><td>-</td><td>Met à jour la date (timestamp optionnel)</td></tr>
      <tr><td><code>mettre à jour la date du fichier CHEMIN TIMESTAMP</code></td><td>-</td><td>Met à jour la date du fichier</td></tr>
      <tr><td><code>copier le fichier SRC vers DEST</code></td><td>-</td><td>Copie un fichier</td></tr>
      <tr><td><code>copier le dossier SRC vers DEST</code></td><td>-</td><td>Copie un dossier</td></tr>
      <tr><td><code>purger le dossier CHEMIN</code></td><td><code>vider le r&eacute;pertoire CHEMIN</code></td><td>Supprime tout le contenu du dossier</td></tr>
      <tr><td><code>afficher le contenu du fichier=CHEMIN</code></td><td><code>cat le fichier</code></td><td>Affiche le contenu d’un fichier</td></tr>
    </table>

    <h4>Résultats compatibles</h4>
    <table>
      <tr><th>Syntaxe</th><th>Alias</th><th>Description</th></tr>
      <tr><td><code>retour N</code></td><td><code>Le script retourne un code N</code></td><td>Vérifie le code de retour</td></tr>
      <tr><td><code>stdout=VALEUR</code></td><td><code>La sortie standard est VALEUR</code></td><td>Compare la sortie standard</td></tr>
      <tr><td><code>stderr=VALEUR</code></td><td><code>La sortie d'erreur est VALEUR</code></td><td>Compare la sortie d'erreur</td></tr>
      <tr><td><code>stdout contient MOTIF</code></td><td><code>La sortie standard contient MOTIF</code>, <code>Le script affiche un code "MOTIF"</code></td><td>Recherche motif dans stdout</td></tr>
      <tr><td><code>stderr contient MOTIF</code></td><td><code>La sortie d'erreur contient MOTIF</code></td><td>Recherche motif dans stderr</td></tr>
      <tr><td><code>le fichier /chemin existe</code></td><td><code>Le fichier /chemin est présent</code></td><td>Vérifie l'existence d'un fichier</td></tr>
      <tr><td><code>Le fichier est présent</code></td><td>-</td><td>Validation de la présence du dernier fichier manipulé</td></tr>
      <tr><td><code>le fichier est copié</code></td><td>-</td><td>Vérifie la copie d'un fichier</td></tr>
      <tr><td><code>le dossier est copié</code></td><td>-</td><td>Vérifie la copie d'un dossier</td></tr>
      <tr><td><code>le fichier CHEMIN a les droits MODE</code></td><td>-</td><td>Vérifie les droits d'un fichier</td></tr>
      <tr><td><code>le dossier CHEMIN a les droits MODE</code></td><td>-</td><td>Vérifie les droits d'un dossier</td></tr>
      <tr><td><code>le fichier CHEMIN contient MOTIF</code></td><td>-</td><td>Recherche un motif dans le fichier</td></tr>
      <tr><td><code>le fichier CHEMIN contient exactement VALEUR</code></td><td>-</td><td>Compare le contenu du fichier</td></tr>
      <tr><td><code>fichier_identique FICHIER1 FICHIER2</code></td><td><code>Le fichier FICHIER1 est identique à FICHIER2</code></td><td>Compare deux fichiers</td></tr>
      <tr><td><code>la date du fichier CHEMIN est TIMESTAMP</code></td><td>-</td><td>Vérifie la date de modification du fichier</td></tr>
      <tr><td><code>le dossier CHEMIN existe</code></td><td>-</td><td>Vérifie l'existence d'un dossier</td></tr>
      <tr><td><code>le dossier CHEMIN contient N fichiers PATTERN</code></td><td>-</td><td>Compte les fichiers correspondants</td></tr>
      <tr><td><code>retour 0 et (stdout contient OK ou stderr contient WARNING)</code></td><td>-</td><td>Combine plusieurs validations avec <code>et</code> ou <code>ou</code></td></tr>

    </table>

    <h3>Paramètres supplémentaires</h3>
    <table>
      <tr><th>Syntaxe</th><th>Alias</th><th>Description</th></tr>
      <tr><td><code>argument NOM=VALEUR [et NOM2=VALEUR2]</code></td><td><code>paramètre NOM=VALEUR</code></td><td>Ajoute un ou plusieurs arguments au batch (chaînez-les avec <code>et</code>)</td></tr>
    </table>
    <p class="example">Format&nbsp;: <code>argument clé=valeur et autre=valeur2</code></p>
    <table>
      <tr><td><code>chemin des logs = /chemin/fichier.log</code></td><td><code>path des logs</code></td><td>Spécifie le fichier log</td></tr>
      <tr><td><code>script sql = fichier.sql</code></td><td>-</td><td>Exécute un script SQL</td></tr>
      <tr><td><code>logs</code></td><td><code>erreurs</code>, <code>fichiers de logs</code></td><td>Recherche d'erreurs dans les journaux</td></tr>
    </table>
    <p>Pour personnaliser la connexion SQL, définissez la variable
    <code>SQL_CONN</code> avant d'exécuter le script généré. La valeur par défaut
    est <code>user/password@db</code>.</p>

    <h4>Résultats compatibles</h4>
    <table>
      <tr><th>Syntaxe</th><th>Alias</th><th>Description</th></tr>
      <tr><td><code>retour N</code></td><td><code>Le script retourne un code N</code></td><td>Vérifie le code de retour</td></tr>
      <tr><td><code>stdout=VALEUR</code></td><td><code>La sortie standard est VALEUR</code></td><td>Compare la sortie standard</td></tr>
      <tr><td><code>stderr=VALEUR</code></td><td><code>La sortie d'erreur est VALEUR</code></td><td>Compare la sortie d'erreur</td></tr>
      <tr><td><code>stdout contient MOTIF</code></td><td><code>La sortie standard contient MOTIF</code>, <code>Le script affiche un code "MOTIF"</code></td><td>Recherche motif dans stdout</td></tr>
      <tr><td><code>stderr contient MOTIF</code></td><td><code>La sortie d'erreur contient MOTIF</code></td><td>Recherche motif dans stderr</td></tr>
      <tr><td><code>le fichier /chemin existe</code></td><td><code>Le fichier /chemin est présent</code></td><td>Vérifie l'existence d'un fichier</td></tr>
      <tr><td><code>Le fichier est présent</code></td><td>-</td><td>Validation de la présence du dernier fichier manipulé</td></tr>
      <tr><td><code>le fichier est copié</code></td><td>-</td><td>Vérifie la copie d'un fichier</td></tr>
      <tr><td><code>le dossier est copié</code></td><td>-</td><td>Vérifie la copie d'un dossier</td></tr>
      <tr><td><code>le fichier CHEMIN a les droits MODE</code></td><td>-</td><td>Vérifie les droits d'un fichier</td></tr>
      <tr><td><code>le dossier CHEMIN a les droits MODE</code></td><td>-</td><td>Vérifie les droits d'un dossier</td></tr>
      <tr><td><code>le fichier CHEMIN contient MOTIF</code></td><td>-</td><td>Recherche un motif dans le fichier</td></tr>
      <tr><td><code>le fichier CHEMIN contient exactement VALEUR</code></td><td>-</td><td>Compare le contenu du fichier</td></tr>
      <tr><td><code>fichier_identique FICHIER1 FICHIER2</code></td><td><code>Le fichier FICHIER1 est identique à FICHIER2</code></td><td>Compare deux fichiers</td></tr>
      <tr><td><code>la date du fichier CHEMIN est TIMESTAMP</code></td><td>-</td><td>Vérifie la date de modification du fichier</td></tr>
      <tr><td><code>le dossier CHEMIN existe</code></td><td>-</td><td>Vérifie l'existence d'un dossier</td></tr>
      <tr><td><code>le dossier CHEMIN contient N fichiers PATTERN</code></td><td>-</td><td>Compte les fichiers correspondants</td></tr>
      <tr><td><code>retour 0 et (stdout contient OK ou stderr contient WARNING)</code></td><td>-</td><td>Combine plusieurs validations avec <code>et</code> ou <code>ou</code></td></tr>

    </table>
  </div>

  <div class="section">
    <h2>Résultats et Validations</h2>
    <table>
      <tr><th>Syntaxe</th><th>Alias</th><th>Description</th></tr>
      <tr><td><code>retour N</code></td><td><code>Le script retourne un code N</code></td><td>Vérifie le code de retour</td></tr>
      <tr><td><code>stdout=VALEUR</code></td><td><code>La sortie standard est VALEUR</code></td><td>Compare la sortie standard</td></tr>
      <tr><td><code>stderr=VALEUR</code></td><td><code>La sortie d'erreur est VALEUR</code></td><td>Compare la sortie d'erreur</td></tr>
      <tr><td><code>stdout contient MOTIF</code></td><td><code>La sortie standard contient MOTIF</code>, <code>Le script affiche un code "MOTIF"</code></td><td>Recherche motif dans stdout</td></tr>
      <tr><td><code>stderr contient MOTIF</code></td><td><code>La sortie d'erreur contient MOTIF</code></td><td>Recherche motif dans stderr</td></tr>
      <tr><td><code>le fichier /chemin existe</code></td><td><code>Le fichier /chemin est présent</code></td><td>Vérifie l'existence d'un fichier</td></tr>
      <tr><td><code>Le fichier est présent</code></td><td>-</td><td>Validation de la présence du dernier fichier manipulé</td></tr>
      <tr><td><code>le fichier est copié</code></td><td>-</td><td>Vérifie la copie d'un fichier</td></tr>
      <tr><td><code>le dossier est copié</code></td><td>-</td><td>Vérifie la copie d'un dossier</td></tr>
      <tr><td><code>le fichier CHEMIN a les droits MODE</code></td><td>-</td><td>Vérifie les droits d'un fichier</td></tr>
      <tr><td><code>le dossier CHEMIN a les droits MODE</code></td><td>-</td><td>Vérifie les droits d'un dossier</td></tr>
      <tr><td><code>le fichier CHEMIN contient MOTIF</code></td><td>-</td><td>Recherche un motif dans le fichier</td></tr>
      <tr><td><code>le fichier CHEMIN contient exactement VALEUR</code></td><td>-</td><td>Compare le contenu du fichier</td></tr>
      <tr><td><code>fichier_identique FICHIER1 FICHIER2</code></td><td><code>Le fichier FICHIER1 est identique à FICHIER2</code></td><td>Compare deux fichiers</td></tr>
      <tr><td><code>la date du fichier CHEMIN est TIMESTAMP</code></td><td>-</td><td>Vérifie la date de modification du fichier</td></tr>
      <tr><td><code>le dossier CHEMIN existe</code></td><td>-</td><td>Vérifie l'existence d'un dossier</td></tr>
      <tr><td><code>le dossier CHEMIN contient N fichiers PATTERN</code></td><td>-</td><td>Compte les fichiers correspondants</td></tr>
      <tr><td><code>retour 0 et (stdout contient OK ou stderr contient WARNING)</code></td><td>-</td><td>Combine plusieurs validations avec <code>et</code> ou <code>ou</code></td></tr>
    </table>
  </div>

  <div class="section">
    <h2>Création de Fichiers de Test</h2>
    <p>Placez vos fichiers <code>.shtest</code> dans le dossier <code>tests/</code>. Exemple :</p>
    <pre><code>Action: configurer le contexte ; Resultat: OK
Action: exécuter mon_batch.sh ; Resultat: retour 0</code></pre>
    <p>Générez les scripts :</p>
    <pre><code>python src/generate_tests.py</code></pre>
    <p>Les résultats sont disponibles dans le dossier <code>output/</code>.</p>
  </div>

  <div class="section">
    <h2>Tutoriel&nbsp;: scénario complet en 5&nbsp;étapes</h2>
    <p>Ce tutoriel illustre un fichier <code>.shtest</code> plus élaboré&nbsp;:</p>
    <pre><code>Step: step&nbsp;1
Action: Ex&eacute;cuter le script SQL = purge.sql ; Resultat: base pr&ecirc;te

Step: step&nbsp;2
Action: D&eacute;placer config.cfg vers /app/sgda/conf/config.cfg ; Resultat: le fichier est copi&eacute;

Step: step&nbsp;3
Action: Cr&eacute;er le dossier = /app/sgda/tmp ; Resultat: le dossier est cr&eacute;&eacute;

Step: step&nbsp;4
Action: Ex&eacute;cuter /app/sgda/data/arbo/batches/purge/purge.sh ; Resultat: retour 0

Step: step&nbsp;5
Action: Lire le fichier = /app/sgda/logs/purge.log ; Resultat: stdout contient "Purge effectu&eacute;e avec succ&egrave;s. Le batch &agrave; retourn&eacute; un code 000"</code></pre>
  </div>
  <div class="section">
    <h2>Interaction avec les scripts Python</h2>
    <p>Les fichiers <code>.shtest</code> sont d'abord analysés par
    <code>parser.py</code> qui applique une série d'expressions régulières pour
    extraire les actions et les validations. Les phrases naturelles sont
    normalisées par <code>AliasResolver</code> afin de produire un dictionnaire
    homogène.</p>
    <p>Ce dictionnaire est ensuite utilisé par
    <code>generate_tests.py</code> pour écrire un script shell. Chaque action est
    convertie à l'aide des gabarits définis dans <code>templates.py</code> puis
    les validations sont traduites en instructions conditionnelles par
    <code>validation_compiler.py</code>.</p>
    <p>Enfin, <code>export_to_excel.py</code> peut parcourir ces mêmes fichiers et
    générer un tableau récapitulatif au format Excel.</p>
  </div>
  <div class="section">
    <h2>Architecture interne des scripts</h2>
    <p>Cette partie détaille la réaction des différents modules vis-à-vis des
    entrées du langage.</p>

    <h3>parser.py</h3>
    <p>Chaque ligne est comparée à des expressions régulières puis traduite en
    dictionnaire structuré. Les phrases naturelles comme
    <code>Le script retourne un code 0</code> sont converties en
    <code>retour 0</code>. Les clés du dictionnaire (&laquo;
    initialization&nbsp;&raquo;, &laquo;&nbsp;execution&nbsp;&raquo;, etc.)
    servent de base à la génération ultérieure.</p>

    <h3>generate_tests.py</h3>
    <p>Une fois les fichiers analysés, ce module sélectionne pour chaque action
    le gabarit approprié dans <code>templates.py</code>. Les scripts SQL
    mentionnés sont lancés via la commande
    <code>sqlplus -S ${SQL_CONN:-user/password@db} @script.sql</code>.</p>

    <h3>validation_compiler.py</h3>
    <p>Les validations composées sont transformées en arbre de syntaxe puis en
    instructions shell. Par exemple
    <code>retour 0 et stdout contient OK</code> devient une série de tests
    stockant leur résultat dans des variables intermédiaires.</p>

    <h3>export_to_excel.py</h3>
    <p>Pour chaque fichier <code>.shtest</code>, un onglet Excel est créé avec les
    actions et les validations canonicalisées. Cela facilite la revue manuelle
    des scénarios.</p>

    <h3>config.ini</h3>
    <p>Les chemins d'entr&eacute;e et de sortie par d&eacute;faut sont d&eacute;finis
    dans ce fichier. S'il est absent, les scripts utilisent
    <code>src/tests</code> et <code>output</code>.</p>
  </div>
</body>
</html>
