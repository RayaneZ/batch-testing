<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Grammaire du langage de tests</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 2em;
  background: #222;
  color: #eee;
}
h1 {
  color: #fff;
  text-shadow: 1px 1px 3px #000;
}
pre, code {
  background: #333;
  padding: 2px 4px;
  border-radius: 4px;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
}
</style>
</head>
<body>
<h1>Grammaire du langage de tests</h1>
<p>Chaque ligne d'un fichier de test utilise la forme&nbsp;:</p>
<pre><code>Action: &lt;description&gt; ; Resultat: &lt;résultat attendu&gt;</code></pre>
<p>Les verbes principaux reconnus sont&nbsp;:</p>
<ul>
<li><code>initialiser</code>, <code>créer</code>, <code>configurer</code></li>
<li><code>exécuter</code>, <code>lancer</code>, <code>traiter</code></li>
<li><code>vérifier</code>, <code>valider</code></li>
<li>opérations sur fichiers&nbsp;: <code>toucher</code>, <code>cat</code></li>
</ul>
<p>Des paramètres spécifiques peuvent être indiqués&nbsp;:</p>
<ul>
<li><code>argument NOM=VALEUR</code> &ndash; ajoute un argument au batch</li>
<li><code>chemin des logs = /chemin/fichier.log</code></li>
<li><code>script sql = fichier.sql</code></li>
<li><code>créer/mettre à jour fichier/dossier = CHEMIN avec les droits = MODE</code></li>
<li><code>toucher le fichier CHEMIN [-t TIMESTAMP]</code></li>
<li><code>copier le fichier SRC vers DEST</code></li>
<li><code>copier le dossier SRC vers DEST</code></li>
<li><code>afficher le contenu du fichier = CHEMIN</code></li>
<li><code>exécuter /chemin/vers/script.sh</code> &ndash; définit le script batch à utiliser</li>
<li><code>Step: NOM_DE_STEP</code> &ndash; démarre une nouvelle étape pour grouper les actions suivantes</li>
<li><code>retour N</code> &ndash; vérifie le code de sortie de la commande</li>
<li><code>stdout=VALEUR</code> / <code>stderr=VALEUR</code> &ndash; compare la sortie standard ou d'erreur</li>
<li><code>stdout contient MOTIF</code> / <code>stderr contient MOTIF</code> &ndash; cherche le motif dans la sortie avec <code>grep</code></li>
<li>Formulations naturelles comme « Le script retourne un code&nbsp;0 » ou « Le script affiche un code&nbsp;"030" » sont aussi reconnues.</li>
</ul>
<p>Les expressions sont interprétées par le parseur défini dans <code>parser.py</code>.</p>

<h2>Créer vos propres fichiers de tests</h2>
<p>Pour écrire un scénario, créez un fichier se terminant par <code>.shtest</code> dans le dossier <code>tests/</code>. Chaque ligne doit respecter la syntaxe ci-dessus.</p>

<pre><code>Action: initialiser le contexte ; Resultat: OK
Action: exécuter mon_batch.sh ; Resultat: retour 0</code></pre>

<p>Ensuite, générez les scripts correspondants en exécutant&nbsp;:</p>
<pre><code>python src/generate_tests.py --batch-path ./mon_batch.sh</code></pre>
<p>Les scripts produits seront placés dans le dossier <code>output/</code>.</p>
</body>
</html>
