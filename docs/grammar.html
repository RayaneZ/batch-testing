<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Grammaire du langage de tests</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 2em;
  background: #222;
  color: #eee;
}
h1 {
  color: #fff;
  text-shadow: 1px 1px 3px #000;
}
pre, code {
  background: #333;
  padding: 2px 4px;
  border-radius: 4px;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
}
.keyword {
  background: #f5deb31f;
  padding: 5px 30px;
  border-radius: 33px;
  margin-bottom: 1em;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}
.alias,
.description,
.exemple {
  margin: 0.25em 0;
}
</style>
</head>
<body>
<h1>Grammaire du langage de tests</h1>
<p>Chaque ligne d'un fichier de test utilise la forme&nbsp;:</p>
<pre><code>Action: &lt;description&gt; ; Resultat: &lt;résultat attendu&gt;</code></pre>
<p>Les verbes principaux reconnus sont&nbsp;:</p>
<ul>
<li><code>créer</code>, <code>configurer</code></li>
<li><code>exécuter</code>, <code>lancer</code>, <code>traiter</code></li>
<li><code>vérifier</code>, <code>valider</code></li>
<li>opérations sur fichiers&nbsp;: <code>toucher</code>, <code>cat</code></li>
</ul>
<p>Des paramètres spécifiques peuvent être indiqués&nbsp;:</p>
<ul>
<li><code>argument NOM=VALEUR</code> &ndash; ajoute un argument au batch</li>
<li><code>chemin des logs = /chemin/fichier.log</code></li>
<li><code>script sql = fichier.sql</code></li>
<li><code>créer/mettre à jour fichier/dossier = CHEMIN avec les droits = MODE</code></li>
<li><code>toucher le fichier CHEMIN [-t TIMESTAMP]</code></li>
<li><code>copier le fichier SRC vers DEST</code></li>
<li><code>copier le dossier SRC vers DEST</code></li>
<li><code>afficher le contenu du fichier = CHEMIN</code></li>
<li><code>exécuter /chemin/vers/script.sh</code> &ndash; définit le script batch à utiliser</li>
<li><code>Step: NOM_DE_STEP</code> &ndash; démarre une nouvelle étape pour grouper les actions suivantes</li>
<li><code>retour N</code> &ndash; vérifie le code de sortie de la commande</li>
<li><code>stdout=VALEUR</code> / <code>stderr=VALEUR</code> &ndash; compare la sortie standard ou d'erreur</li>
<li><code>stdout contient MOTIF</code> / <code>stderr contient MOTIF</code> &ndash; cherche le motif dans la sortie avec <code>grep</code></li>
<li>Formulations naturelles comme « Le script retourne un code&nbsp;0 » ou « Le script affiche un code&nbsp;"030" » sont aussi reconnues.</li>
</ul>
<p>Les expressions sont interprétées par le parseur défini dans <code>parser.py</code>.</p>

<h2>Détails des mots clés et alias</h2>
<div class="keyword">
<h3><code>créer</code></h3>
<p class="alias"><strong>Alias&nbsp;:</strong> <code>configurer</code></p>
<p class="description">Prépare l’environnement de test. Le verbe est détecté lorsqu’il apparaît seul au début de la partie Action&nbsp;: <code>(créer|configurer)</code>. Évitez les formulations plus longues.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Action: configurer la base ; Resultat: OK</code></p>
</div>

<div class="keyword">
<h3><code>exécuter</code></h3>
<p class="alias"><strong>Alias&nbsp;:</strong> <code>lancer</code>, <code>traiter</code></p>
<p class="description">Lance le traitement du batch. Le mot clé est reconnu via <code>(exécuter|lancer|traiter)</code> au début de la phrase.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Action: exécuter ; Resultat: retour 0</code></p>
</div>

<div class="keyword">
<h3><code>exécuter /chemin/script.sh</code></h3>
<p class="description">Définit le chemin du script batch à utiliser. Le chemin est capturé avec <code>exécuter\s+(\/\S+\.sh)</code>.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Action: exécuter /opt/proc.sh ; Resultat: retour 0</code></p>
</div>

<div class="keyword">
<h3><code>argument</code></h3>
<p class="alias"><strong>Alias&nbsp;:</strong> <code>paramètre</code></p>
<p class="description">Ajoute un argument au batch en utilisant la forme <code>argument NOM=VALEUR</code>. Le parser cherche <code>(argument|paramètre)\s+(\S+)=\s*(\S+)</code>.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Action: argument MODE=demo ; Resultat: OK</code></p>
</div>

<div class="keyword">
<h3><code>chemin des logs</code></h3>
<p class="description">Spécifie le fichier de logs via <code>chemin des logs = FICHIER</code>. Le mot est détecté avec <code>(?:chemin|path) des logs\s*=\s*(\S+)</code>.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Action: chemin des logs = /tmp/app.log ; Resultat: OK</code></p>
</div>

<div class="keyword">
<h3><code>script sql</code></h3>
<p class="description">Exécute un script SQL avant le test. Le fichier est reconnu grâce à <code>script sql\s*=\s*(.*?\.sql)</code>.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Action: script sql = init.sql ; Resultat: retour 0</code></p>
</div>

<div class="keyword">
<h3><code>créer/mettre à jour fichier/dossier</code></h3>
<p class="description">Crée ou modifie un fichier ou un dossier&nbsp;: <code>(créer|mettre à jour) (fichier|dossier)=CHEMIN avec les droits=MODE</code>.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Action: créer fichier=/tmp/a.txt avec les droits=644 ; Resultat: OK</code></p>
</div>

<div class="keyword">
<h3><code>toucher le fichier</code></h3>
<p class="description">Met à jour la date d’un fichier via <code>toucher le fichier CHEMIN -t TIMESTAMP</code>. Le timestamp est optionnel mais doit suivre immédiatement.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Action: toucher le fichier /tmp/a.txt -t 20240601 ; Resultat: OK</code></p>
</div>

<div class="keyword">
<h3><code>copier le fichier</code> / <code>copier le dossier</code></h3>
<p class="description">Copie un fichier ou un dossier en utilisant <code>copier (fichier|dossier) SRC vers DEST</code>. L’ordre doit être respecté pour être détecté.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Action: copier le fichier /tmp/src.txt vers /tmp/dest.txt ; Resultat: le fichier est copié</code></p>
</div>

<div class="keyword">
<h3><code>afficher le contenu du fichier</code></h3>
<p class="alias"><strong>Alias&nbsp;:</strong> <code>cat le fichier</code></p>
<p class="description">Affiche le contenu d’un fichier. Le motif <code>(afficher le contenu du fichier|cat le fichier)\s*=\s*(\S+)</code> est utilisé.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Action: afficher le contenu du fichier=/tmp/info.log ; Resultat: OK</code></p>
</div>

<div class="keyword">
<h3><code>logs</code></h3>
<p class="alias"><strong>Alias&nbsp;:</strong> <code>erreurs</code>, <code>fichiers de logs</code></p>
<p class="description">Recherche des erreurs dans les journaux. Le parser détecte <code>(logs|erreurs|fichiers de logs)</code> seul dans la ligne d’action.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Action: logs ; Resultat: stdout contient ERROR</code></p>
</div>

<div class="keyword">
<h3><code>Step</code></h3>
<p class="alias"><strong>Alias&nbsp;:</strong> <code>Etape</code>, <code>Étape</code></p>
<p class="description">Marque une nouvelle étape&nbsp;: <code>(Étape|Etape|Step)\s*:\s*nom</code>. Le mot doit précéder un nom d’étape.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Step: Initialisation</code></p>
</div>

<div class="keyword">
<h3><code>retour</code></h3>
<p class="description">Vérifie le code de sortie avec la forme <code>retour N</code>.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Resultat: retour 0</code></p>
</div>

<div class="keyword">
<h3><code>stdout</code> / <code>stderr</code></h3>
<p class="description">Compare ou recherche un motif dans les sorties. Les syntaxes <code>stdout=VALEUR</code>, <code>stderr=VALEUR</code>, <code>stdout contient MOTIF</code> ou <code>stderr contient MOTIF</code> sont détectées via des expressions régulières dédiées.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Resultat: stdout contient OK</code></p>
</div>

<div class="keyword">
<h3>Expressions composées</h3>
<p class="description">Plusieurs validations peuvent être combinées avec <code>et</code> ou <code>ou</code>. Les parenthèses sont interprétées grâce à l’algorithme de shunting yard.</p>
<p class="exemple"><em>Exemple&nbsp;:</em> <code>Resultat: retour 0 et (stdout contient OK ou stderr contient WARNING)</code></p>
</div>

<div class="keyword">
<h3>Alias naturels</h3>
<p class="description">Des phrases comme «&nbsp;Le script retourne un code N&nbsp;» ou «&nbsp;Le script affiche un code "N"&nbsp;» sont transformées respectivement en <code>retour N</code> et <code>stdout contient N</code>.</p>
</div>

<h2>Créer vos propres fichiers de tests</h2>
<p>Pour écrire un scénario, créez un fichier se terminant par <code>.shtest</code> dans le dossier <code>tests/</code>. Chaque ligne doit respecter la syntaxe ci-dessus.</p>

<pre><code>Action: configurer le contexte ; Resultat: OK
Action: exécuter mon_batch.sh ; Resultat: retour 0</code></pre>

<p>Ensuite, générez les scripts correspondants en exécutant&nbsp;:</p>
<pre><code>python src/generate_tests.py --batch-path ./mon_batch.sh</code></pre>
<p>Les scripts produits seront placés dans le dossier <code>output/</code>.</p>
</body>
</html>
